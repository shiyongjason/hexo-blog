---
title: 闭包 变量
date: 2023-01-11 15:03:48
tags:
---
##闭包就是functions that return function  
(是输出而是返回一个函数) f()()  
变量的作用域无非就是两种：全局变量和局部变量。

```auto
函数内部可以直接读取全局变量。
```

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var n = 1;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f1</span></span>(){</span><br><span class="line">  	console.log(n)</span><br><span class="line">}</span><br><span class="line">f1(); // 1</span><br></pre></td></tr></tbody></table>

```auto
在函数外部自然无法读取函数内的局部变量
**函数内部声明变量的时候，一定要使用var命令。如果不用的话，你实际上声明了一个全局变量**
```

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f1</span></span>(){</span><br><span class="line">　　　　var n=1;</span><br><span class="line">　　}</span><br><span class="line">　	　alert(n); // error</span><br></pre></td></tr></tbody></table>

### [](#如何从外部读取局部变量？ "如何从外部读取局部变量？")如何从外部读取局部变量？

```auto
函数的内部，再定义一个函数。
```

<table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">f1</span></span>(){</span><br><span class="line">　　　　var n=2;</span><br><span class="line">　　　　<span class="keyword">function</span> <span class="function"><span class="title">f2</span></span>(){</span><br><span class="line">　　　　　　alert(n); // 2</span><br><span class="line">　　　　}</span><br><span class="line">　　}</span><br><span class="line">----</span><br><span class="line">　　<span class="keyword">function</span> <span class="function"><span class="title">f1</span></span>(){</span><br><span class="line">　　　　var n=1;</span><br><span class="line">　　　　<span class="keyword">function</span> <span class="function"><span class="title">f2</span></span>(){</span><br><span class="line">　　　　　　alert(n); </span><br><span class="line">　　　　}</span><br><span class="line">　　　　<span class="built_in">return</span> f2;</span><br><span class="line">　　}</span><br><span class="line">　　var result=f1();</span><br><span class="line">　　result(); // 1</span><br></pre></td></tr></tbody></table>

函数f2就被包括在函数f1内部，这时f1内部的所有局部变量，对f2都是可见的。但是反过来就不行，f2内部的局部变量，对f1就是不可见的。  
这就是Javascript语言特有的”链式作用域”结构（chain scope），子对象会一级一级地向上寻找所有父对象的变量。所以，父对象的所有变量，对子对象都是可见的，反之则不成立。

```auto
@闭包可以用在许多地方。它的最大用处有两个，一个是前面提到的可以读取函数内部的变量，
另一个就是让这些变量的值始终保持在内存中
```

### [](#使用闭包的注意点 "使用闭包的注意点")使用闭包的注意点

1）由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。

2）闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。